# daloradius_installer
# web-ui는 daloRADIUS 1.3(by Liran Tal)
# OS는 Rocky Linux 8 minimal 버전 기준.

<추가 기능>
※ NAS 추가후 radiusd 데몬 재시작 버튼 추가됨.(권한 수정 필요)
※ Accounting 페이지에 리스트 일부 수정

<설치 방법>
1) 먼저 설치해야한 프로그램 git, httpd 설치
   dnf -y install git httpd

2) cd /var/www/html/

3) 3-1) 또는 3-2) 선택해서 실행.

3-1) 한줄로 명령어 실행.
git clone https://github.com/cockcut/daloradius_13_installer private; cd private; chmod +x radius_install.sh; ./radius_install.sh

아래 입력 프롬트프에서 Enter(default 적용됨) 또는 입력값 입력후 Enter

   a. MySQL/MariaDB root 비밀번호를 입력하세요:       -----> "mysql의 root 패스워드 입력후 Enter"
   b. Enter MySQL Host (default: localhost):        -----> "Entert입력시 기본값으로 설정"
   c. Enter MySQL Port (default: 3306):             -----> "Entert입력시 기본값으로 설정"
   d. Enter MySQL Database (default: radius):       -----> "Entert입력시 기본값으로 설정"
   e. Enter MySQL User (default: radius):           -----> "Entert입력시 기본값으로 설정"
   f. Enter MySQL Password (default: radius12#$):    -----> "Entert입력시 기본값으로 설정"

3-2) 단계별로 별령어 실행.

   3-2-1) git 레포지토리 복사하여 private 폴더에 다운로그 하기

      git clone https://github.com/cockcut/daloradius_13_installer private

   3-2-2) 다운받은 private 폴더로 이동

      cd private

   3-2-3) 자동설치 스크립트에 실행권한 주기

      chmod +x radius_install.sh

   3-2-4) 자동설치 스크립트에 실행
   
      ./radius_install.sh

      아래 입력 프롬트프에서 Enter(default 적용됨) 또는 입력값 입력후 Enter

         a. MySQL/MariaDB root 비밀번호를 입력하세요:       -----> "mysql의 root 패스워드 입력후 Enter"
         b. Enter MySQL Host (default: localhost):        -----> "Entert입력시 기본값으로 설정"
         c. Enter MySQL Port (default: 3306):             -----> "Entert입력시 기본값으로 설정"
         d. Enter MySQL Database (default: radius):       -----> "Entert입력시 기본값으로 설정"
         e. Enter MySQL User (default: radius):           -----> "Entert입력시 기본값으로 설정"
         f. Enter MySQL Password (default: radius12#$):    -----> "Entert입력시 기본값으로 설정"

4) http://'serverip'/private/radius 접속

5) 초기 WEB-UI ID/비번 : administrator / radius

6) 추가 기능 : 조건에 부합하고 인증성공시에만 맥주소 등록하는 방법, 아래 내용을 수동으로 수정해야함.

<맥주소 자동등록 >
/etc/raddb/sites-available/default 에 아래 내용을 post-auth 섹션에 sql 밑부분쪽에 추가


# ===== WISPR-MACAUTH 자동 사용자 등록 =====
	# Called-Station-Id에 macauth(이부분만 수정하면 됨)가 포함되어있고 인증이 성공(Access-Accept)하였을때만 맥주소 자동등록
	if (&Called-Station-Id =~ /macauth/i && &reply:Packet-Type == Access-Accept) {
		# MAC 주소(Calling-Station-Id) 형식
		update control {
			#&Tmp-String-0 := "%{tolower:%{Calling-Station-Id}}" ###소문자
			#&Tmp-String-0 := "%{toupper:%{Calling-Station-Id}}" ###대문자
			&Tmp-String-0 := "%{Calling-Station-Id}"
		}

		# radcheck에 이미 존재하는지 확인 (0이면 없음)
		update control {
			&Tmp-Integer-0 := "%{sql:SELECT COUNT(*) FROM radcheck WHERE UserName = '%{control:Tmp-String-0}'}"
		}

		if (&control:Tmp-Integer-0 == 0) {
			# radcheck에 Cleartext-Password로 MAC 자동 등록
			"%{sql:INSERT INTO radcheck (UserName, Attribute, op, Value) \
			         VALUES ('%{control:Tmp-String-0}', 'Cleartext-Password', ':=', '%{control:Tmp-String-0}')}"

			# userinfo 자동 생성
			"%{sql:INSERT INTO userinfo \
			         (username, firstname, lastname, creationdate, creationby) \
			         VALUES ('%{control:Tmp-String-0}', 'Auto', 'MAC-User', NOW(), 'wispr-macauth')}"

			# userbillinfo 자동 생성
			"%{sql:INSERT INTO userbillinfo \
			         (username, creationdate, creationby) \
			         VALUES ('%{control:Tmp-String-0}', NOW(), 'wispr-macauth')}"

			# 클라이언트에게 성공 메시지 (디버그용, 필요 없으면 삭제 또는 주석처리)
#			update reply {
#				&Reply-Message += "MAC user %{control:Tmp-String-0} auto-created"
#			}
		}
	}
# ===== WISPR-MACAUTH 자동 사용자 등록 끝 =====

