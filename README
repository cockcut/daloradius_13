# daloradius_installer
# web-ui는 daloRADIUS 1.3(by Liran Tal)
# OS는 Rocky Linux 8 minimal 버전 기준.

<추가 기능>
※ NAS 추가후 radiusd 데몬 재시작 버튼 추가됨.(권한 수정 필요)
※ Accounting 페이지에 리스트 일부 수정

<설치 방법>
1) 먼저 설치해야한 프로그램 git, httpd 설치
   dnf -y install git httpd

2) cd /var/www/html/

3) 3-1) 또는 3-2) 선택해서 실행.

3-1) 한줄로 명령어 실행.
git clone https://github.com/cockcut/daloradius_13_installer private; cd private; chmod +x radius_install.sh; ./radius_install.sh

아래 입력 프롬트프에서 Enter(default 적용됨) 또는 입력값 입력후 Enter

   a. MySQL/MariaDB root 비밀번호를 입력하세요:       -----> "mysql의 root 패스워드 입력후 Enter"
   b. Enter MySQL Host (default: localhost):        -----> "Entert입력시 기본값으로 설정"
   c. Enter MySQL Port (default: 3306):             -----> "Entert입력시 기본값으로 설정"
   d. Enter MySQL Database (default: radius):       -----> "Entert입력시 기본값으로 설정"
   e. Enter MySQL User (default: radius):           -----> "Entert입력시 기본값으로 설정"
   f. Enter MySQL Password (default: radius12#$):    -----> "Entert입력시 기본값으로 설정"

3-2) 단계별로 별령어 실행.

   3-2-1) git 레포지토리 복사하여 private 폴더에 다운로그 하기

      git clone https://github.com/cockcut/daloradius_13_installer private

   3-2-2) 다운받은 private 폴더로 이동

      cd private

   3-2-3) 자동설치 스크립트에 실행권한 주기

      chmod +x radius_install.sh

   3-2-4) 자동설치 스크립트에 실행
   
      ./radius_install.sh

      아래 입력 프롬트프에서 Enter(default 적용됨) 또는 입력값 입력후 Enter

         a. MySQL/MariaDB root 비밀번호를 입력하세요:       -----> "mysql의 root 패스워드 입력후 Enter"
         b. Enter MySQL Host (default: localhost):        -----> "Entert입력시 기본값으로 설정"
         c. Enter MySQL Port (default: 3306):             -----> "Entert입력시 기본값으로 설정"
         d. Enter MySQL Database (default: radius):       -----> "Entert입력시 기본값으로 설정"
         e. Enter MySQL User (default: radius):           -----> "Entert입력시 기본값으로 설정"
         f. Enter MySQL Password (default: radius12#$):    -----> "Entert입력시 기본값으로 설정"

4) http://'serverip'/private/radius 접속

5) 초기 WEB-UI ID/비번 : administrator / radius

6) 추가 기능 : 조건에 부합하고 인증성공시에만 맥주소 등록하는 방법, 아래 내용을 수동으로 수정해야함.

<맥주소 자동등록 >
/etc/raddb/sites-available/default 에 아래 내용을 post-auth 섹션에 sql 밑부분쪽에 추가


# ===== WISPR-MACAUTH 자동 사용자 등록 =====
# ============================================================
    # [관리자 설정 섹션] 여기서 값을 변경하세요
# ============================================================
    update control {
# ============================================================
    # 1) MAC 주소 포맷 설정 (원하는 번호로 변경하세요)
    # 0: 원본 그대로 (변경 없음)
    # 1: 구분자 ':', 소문자 (aa:bb:cc:dd:ee:ff)
    # 2: 구분자 ':', 대문자 (AA:BB:CC:DD:EE:FF)
    # 3: 구분자 '-', 소문자 (aa-bb-cc-dd-ee-ff)
    # 4: 구분자 '-', 대문자 (AA-BB-CC-DD-EE-FF)
    # 5: 구분자 없음, 소문자 (aabbccddeeff)
    # 6: 구분자 없음, 대문자 (AABBCCDDEEFF)
    # ============================================================
        Tmp-Integer-1 := 0  # <--- 여기에 원하는 옵션 번호(0~5)를 입력하세요
    # ============================================================
    # 2) Called-Station-Id에서 확인할 특정 문구 설정 (맥주소를 저장할 SSID)
    # 예: "wispr-macauth", "Guest-WiFi" 등
    # ============================================================
        Tmp-String-1 := "wispr-macauth" # <--- 맥주소를 저장할 SSID를 입력하세요
    # ============================================================
    }
    
    # ============================================================
    # [로직 시작] MAC 포맷 변환
    # ============================================================
    # 옵션이 0이 아니고, MAC 주소 형식이 유효한 경우에만 변환 수행
    if ((&control:Tmp-Integer-1 != 0) && (&Calling-Station-Id =~ /^([0-9a-fA-F]{2})[:.-]?([0-9a-fA-F]{2})[:.-]?([0-9a-fA-F]{2})[:.-]?([0-9a-fA-F]{2})[:.-]?([0-9a-fA-F]{2})[:.-]?([0-9a-fA-F]{2})$/)) {
        # 1. 구분자 ':', 소문자
        if (&control:Tmp-Integer-1 == 1) {
            update request { Calling-Station-Id := "%{tolower:%{1}:%{2}:%{3}:%{4}:%{5}:%{6}}" }
        }
        # 2. 구분자 ':', 대문자
        elsif (&control:Tmp-Integer-1 == 2) {
            update request { Calling-Station-Id := "%{toupper:%{1}:%{2}:%{3}:%{4}:%{5}:%{6}}" }
        }
        # 3. 구분자 '-', 소문자
        elsif (&control:Tmp-Integer-1 == 3) {
            update request { Calling-Station-Id := "%{tolower:%{1}-%{2}-%{3}-%{4}-%{5}-%{6}}" }
        }
        # 4. 구분자 '-', 대문자
        elsif (&control:Tmp-Integer-1 == 4) {
            update request { Calling-Station-Id := "%{toupper:%{1}-%{2}-%{3}-%{4}-%{5}-%{6}}" }
        }
        # 5. 구분자 없음, 소문자
        elsif (&control:Tmp-Integer-1 == 5) {
            update request { Calling-Station-Id := "%{tolower:%{1}%{2}%{3}%{4}%{5}%{6}}" }
        }
        # 6. 구분자 없음, 대문자
        elsif (&control:Tmp-Integer-1 == 6) {
            update request { Calling-Station-Id := "%{toupper:%{1}%{2}%{3}%{4}%{5}%{6}}" }
        }
    }

    # ============================================================
    # [DB 저장 로직] 설정된 문구(Tmp-String-1)를 이용해 조건 확인
    # ============================================================
    
    # Called-Station-Id 안에 위에서 설정한 문구(%{control:Tmp-String-1})가 포함되어 있는지 확인
    if ("%{Called-Station-Id}" =~ /%{control:Tmp-String-1}/) {

        # radcheck에 해당 MAC 주소가 없는지 확인
        if ("%{sql:SELECT COUNT(*) FROM radcheck WHERE UserName='%{Calling-Station-Id}'}" == "0") {

            # (1) radcheck 테이블 입력
            update control {
                Tmp-String-0 := "%{sql:INSERT INTO radcheck (UserName, Attribute, Op, Value) VALUES ('%{Calling-Station-Id}', 'Cleartext-Password', ':=', '%{Calling-Station-Id}') ON DUPLICATE KEY UPDATE Value = '%{Calling-Station-Id}'}"
            }

            # (2) userinfo 테이블 입력
            update control {
                Tmp-String-0 := "%{sql:INSERT IGNORE INTO userinfo (username, creationdate, creationby) VALUES ('%{Calling-Station-Id}', NOW(), '%{User-Name}')}"
            }

            # (3) userbillinfo 테이블 입력
            update control {
                Tmp-String-0 := "%{sql:INSERT IGNORE INTO userbillinfo (username, creationdate, creationby) VALUES ('%{Calling-Station-Id}', NOW(), '%{User-Name}')}"
            }
        }
    }
# ===== WISPR-MACAUTH 자동 사용자 등록 끝=====

